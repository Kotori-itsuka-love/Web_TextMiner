<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>要你命3000——信息提取系统</title>
    <!-- 引入Google字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- 引入Font Awesome图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 引入SheetJS (用于Excel导出) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- 引入PDF导出库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas2image@1.0.5/canvas2image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* 全局样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 导航栏样式 */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--light);
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }

        .nav-btn.primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), #6010a0);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 主内容区域 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        /* 左侧功能区样式 */
        .analysis-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* 卡片样式 */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 0;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f2f5;
        }

        .card-icon {
            font-size: 1.5rem;
            color: var(--primary);
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }

        /* 输入方式选择 */
        .input-method {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .method-card {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: white;
        }

        .method-card.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
            transform: scale(1.02);
        }

        .method-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .method-card h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .method-card p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        /* 文本输入区域 */
        .input-section {
            position: relative;
        }

        .textarea-input {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
            background: white;
        }

        .textarea-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .char-count {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* 文件上传区域 */
        .file-upload-container {
            display: none;
            text-align: center;
            padding: 30px;
            border: 2px dashed #e2e8f0;
            border-radius: var(--border-radius);
            background: white;
            transition: var(--transition);
        }

        .file-upload-container.active {
            display: block;
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.03);
        }

        .file-upload-container i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .file-upload-label {
            display: inline-block;
            padding: 12px 30px;
            background: var(--primary);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }

        .file-upload-label:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        #file {
            display: none;
        }

        .file-name {
            margin-top: 15px;
            font-size: 0.95rem;
            color: var(--gray);
        }

        /* 功能选择区域 */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 25px 20px;
            text-align: center;
            transition: var(--transition);
            background: white;
            cursor: pointer;
        }

        .feature-card.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .feature-card i {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .feature-card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .feature-card p {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* 按钮样式 */
        .btn-container {
            text-align: center;
            margin: 40px 0;
        }

        .process-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }

        .process-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.5);
        }

        .process-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* 结果区域 */
        .result-section {
            display: none;
            margin-top: 0;
        }

        .result-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 25px;
            background: #e9ecef;
            border: none;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
            padding: 25px;
            background: white;
            border-radius: 0 var(--border-radius) var(--border-radius) var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            min-height: 200px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 结果卡片样式 */
        .result-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .result-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f2f5;
            color: var(--dark);
        }

        .result-card h4 i {
            color: var(--primary);
        }

        /* 导出按钮 */
        .export-btns {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--light);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .export-btn:hover {
            background: #e9ecef;
        }

        .export-btn.excel {
            background: #21a366;
            color: white;
        }

        .export-btn.excel:hover {
            background: #1a8c57;
        }

        .export-btn.pdf {
            background: #e74c3c;
            color: white;
        }

        .export-btn.pdf:hover {
            background: #c0392b;
        }

        /* 加载动画 */
        .loader {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(67, 97, 238, 0.2);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 实体标签样式 */
        .entity-tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            margin: 2px 5px 2px 0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .entity-PERSON { background: rgba(6, 214, 160, 0.2); color: #056b53; }
        .entity-ORG { background: rgba(67, 97, 238, 0.2); color: #2c44b1; }
        .entity-GPE { background: rgba(239, 71, 111, 0.2); color: #b21e40; }
        .entity-LOC { background: rgba(255, 209, 102, 0.2); color: #9c7a27; }
        .entity-DATE { background: rgba(114, 9, 183, 0.2); color: #5c048c; }

        /* 图表容器 */
        .chart-container {
            height: 300px;
            margin: 20px 0;
            position: relative;
        }

        /* 右侧功能区样式 */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* 用户面板 */
        .user-panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            text-align: center;
        }

        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            overflow: hidden;
            cursor: pointer;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
            cursor: pointer;
        }

        .user-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* 历史记录面板 */
        .history-panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid #f0f2f5;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .history-item:hover {
            background: #f8f9fa;
        }

        .history-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .history-text {
            font-size: 0.9rem;
            color: var(--gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-date {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .history-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .history-item:hover .history-actions {
            opacity: 1;
        }

        .history-action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f0f2f5;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .history-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* 客服面板 */
        .support-panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
        }

        .support-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .support-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            cursor: pointer;
            transition: var(--transition);
        }

        .support-option:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .support-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.5rem;
            overflow: hidden;
        }

        .support-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .support-text h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .support-text p {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .submit-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .gender-group {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }

        .gender-option {
            flex: 1;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .gender-option.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }

        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            min-height: 44px;
        }

        .tag {
            background: #e2e8f0;
            padding: 5px 10px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag-remove {
            cursor: pointer;
            font-size: 0.8rem;
        }

        .tag-input input {
            flex: 1;
            border: none;
            outline: none;
            min-width: 100px;
        }

        /* 反馈列表样式 */
        .feedback-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .feedback-item {
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 15px;
            background: white;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .feedback-user {
            font-weight: 600;
            color: var(--primary);
        }

        .feedback-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .feedback-content {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .feedback-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        /* 响应式设计 */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                grid-row: 1;
            }
        }

        @media (max-width: 768px) {
            .input-method {
                flex-direction: column;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .logo-text {
                font-size: 1.5rem;
            }

            .nav-right {
                gap: 10px;
            }

            .nav-btn span {
                display: none;
            }

            .nav-btn i {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="modal" id="userFeedbackModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>我的反馈记录</h3>
            <button class="close-modal" onclick="document.getElementById('userFeedbackModal').style.display = 'none'">&times;</button>
        </div>
        <div class="modal-body">
            <div id="userFeedbackList" class="feedback-list"></div>
        </div>
    </div>
</div>

    <!-- 登录模态框 -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>登录账户</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="loginEmail">电子邮箱</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="请输入您的邮箱">
                </div>
                <div class="form-group">
                    <label for="loginPassword">密码</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="请输入密码">
                </div>
                <button class="submit-btn">登录</button>
                <p style="text-align: center; margin-top: 20px;">
                    还没有账户？ <a href="#" id="showRegister" style="color: var(--primary); font-weight: 600;">立即注册</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 注册模态框 -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>创建账户</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="registerName">用户名</label>
                    <input type="text" id="registerName" class="form-control" placeholder="设置您的用户名">
                </div>
                <div class="form-group">
                    <label for="registerEmail">电子邮箱</label>
                    <input type="email" id="registerEmail" class="form-control" placeholder="请输入您的邮箱">
                </div>
                <div class="form-group">
                    <label for="registerPassword">密码</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="设置密码（至少8位）">
                </div>
                <div class="form-group">
                    <label for="registerConfirm">确认密码</label>
                    <input type="password" id="registerConfirm" class="form-control" placeholder="再次输入密码">
                </div>
                <div class="form-group">
                    <label for="registerAvatar">上传头像</label>
                    <input type="file" id="registerAvatar" class="form-control" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="registerPhone">电话号码</label>
                    <input type="tel" id="registerPhone" class="form-control" placeholder="请输入您的电话号码">
                </div>
                <div class="form-group">
                    <label>性别</label>
                    <div class="gender-group">
                        <div class="gender-option" data-gender="male">男</div>
                        <div class="gender-option" data-gender="female">女</div>
                        <div class="gender-option" data-gender="other">其他</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="registerAge">年龄</label>
                    <input type="number" id="registerAge" class="form-control" placeholder="请输入您的年龄">
                </div>
                <div class="form-group">
                    <label>个人标签</label>
                    <div class="tag-input" id="tagInput">
                        <input type="text" id="newTag" placeholder="输入标签后按回车">
                    </div>
                </div>
                <button class="submit-btn">注册</button>
                <p style="text-align: center; margin-top: 20px;">
                    已有账户？ <a href="#" id="showLogin" style="color: var(--primary); font-weight: 600;">立即登录</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 个人中心模态框 -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>个人中心</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="text-align: center;">
                    <div class="user-avatar" style="width: 120px; height: 120px; margin: 0 auto 20px; cursor: pointer;">
                        <img id="profileAvatar" src="" alt="用户头像">
                    </div>
                    <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                </div>
                <div class="form-group">
                    <label for="profileName">用户名</label>
                    <input type="text" id="profileName" class="form-control" placeholder="用户名">
                </div>
                <div class="form-group">
                    <label for="profileEmail">电子邮箱</label>
                    <input type="email" id="profileEmail" class="form-control" placeholder="电子邮箱" disabled>
                </div>
                <div class="form-group">
                    <label for="profilePhone">电话号码</label>
                    <input type="tel" id="profilePhone" class="form-control" placeholder="电话号码">
                </div>
                <div class="form-group">
                    <label>性别</label>
                    <div class="gender-group">
                        <div class="gender-option" data-gender="male">男</div>
                        <div class="gender-option" data-gender="female">女</div>
                        <div class="gender-option" data-gender="other">其他</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="profileAge">年龄</label>
                    <input type="number" id="profileAge" class="form-control" placeholder="年龄">
                </div>
                <div class="form-group">
                    <label>个人标签</label>
                    <div class="tag-input" id="profileTagInput">
                        <input type="text" id="profileNewTag" placeholder="输入标签后按回车">
                    </div>
                </div>
                <button class="submit-btn" id="saveProfileBtn">保存修改</button>
            </div>
        </div>
    </div>

    <!-- 反馈模态框 -->
    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>问题反馈</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="feedbackType">反馈类型</label>
                    <select id="feedbackType" class="form-control">
                        <option value="bug">系统错误</option>
                        <option value="suggestion">功能建议</option>
                        <option value="other">其他问题</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feedbackContent">反馈内容</label>
                    <textarea id="feedbackContent" class="form-control" rows="5" placeholder="请详细描述您的问题或建议..."></textarea>
                </div>
                <button class="submit-btn" id="submitFeedbackBtn">提交反馈</button>
            </div>
        </div>
    </div>

    <!-- 管理员面板模态框 -->
    <div class="modal" id="adminPanelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>管理员面板</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-bottom: 20px; text-align: center;">用户反馈</h3>
                <div class="feedback-list" id="adminFeedbackList">
                    <!-- 反馈内容将在这里动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 导航栏 -->
        <nav>
            <div class="logo">
                <i class="fas fa-brain logo-icon"></i>
                <div class="logo-text">专业提取信息100年</div>
            </div>

            <div class="nav-right">
                <button class="nav-btn" id="myFeedbackBtn">
                    <i class="fas fa-comment"></i><span>我的反馈</span>
                </button>
                <button class="nav-btn" id="supportBtn">
                    <i class="fas fa-headset"></i>
                    <span>问题反馈</span>
                </button>
                <button class="nav-btn" id="adminBtn" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                    <span>管理员</span>
                </button>
                <div id="userSection">
                    <button class="nav-btn primary" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>登录/注册</span>
                    </button>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <!-- 左侧分析区域 -->
            <div class="analysis-section">
                <!-- 输入方式卡片 -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-pencil-alt card-icon"></i>
                        <h2>输入方式</h2>
                    </div>

                    <div class="input-method">
                        <div class="method-card active" id="textMethod">
                            <i class="fas fa-font"></i>
                            <h3>文本输入</h3>
                            <p>直接在文本框中输入或粘贴内容</p>
                        </div>

                        <div class="method-card" id="fileMethod">
                            <i class="fas fa-file-upload"></i>
                            <h3>文件上传</h3>
                            <p>上传TXT文件进行分析（最大10MB）</p>
                        </div>
                    </div>

                    <!-- 文本输入区域 -->
                    <div class="input-section" id="textInputSection">
                        <textarea id="inputText" class="textarea-input" placeholder="请输入您的文本内容..."></textarea>
                        <div class="char-count">0 字符</div>
                    </div>

                    <!-- 文件上传区域 -->
                    <div class="file-upload-container" id="fileInputSection">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <label class="file-upload-label">
                            <i class="fas fa-upload"></i> 选择文件
                            <input type="file" id="file" name="file" accept=".txt">
                        </label>
                        <div class="file-name" id="fileName">未选择文件</div>
                    </div>
                </div>

                <!-- 功能选择卡片 -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-cogs card-icon"></i>
                        <h2>分析功能</h2>
                    </div>

                    <div class="features-grid">
                        <div class="feature-card active" data-feature="entities">
                            <i class="fas fa-tags"></i>
                            <h3>命名实体识别</h3>
                            <p>识别人名、地点、组织等命名实体</p>
                        </div>

                        <div class="feature-card active" data-feature="pos_tags">
                            <i class="fas fa-comment-dots"></i>
                            <h3>词性标注</h3>
                            <p>标注每个词的词性（名词、动词等）</p>
                        </div>

                        <div class="feature-card" data-feature="dep_parse">
                            <i class="fas fa-project-diagram"></i>
                            <h3>依存句法分析</h3>
                            <p>分析句子中词语之间的语法关系</p>
                        </div>

                        <div class="feature-card active" data-feature="sentiment">
                            <i class="fas fa-smile"></i>
                            <h3>情感分析</h3>
                            <p>分析文本的情感倾向和主观程度</p>
                        </div>
                    </div>
                </div>

                <!-- 处理按钮 -->
                <div class="btn-container">
                    <button id="processBtn" class="process-btn">
                        <i class="fas fa-play-circle"></i> 开始分析
                    </button>
                </div>

                <!-- 加载动画 -->
                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <p>正在分析中，请稍候...</p>
                </div>

                <!-- 结果区域 -->
                <div class="card result-section" id="resultSection">
                    <div class="card-header">
                        <i class="fas fa-chart-bar card-icon"></i>
                        <h2>分析结果</h2>

                        <div class="export-btns">
                            <button class="export-btn excel" id="exportExcel">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="export-btn pdf" id="exportPDF">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>

                    <div class="result-tabs" id="resultTabs">
                        <!-- 标签页按钮将通过JS动态生成 -->
                    </div>

                    <div class="tab-content-container" id="tabContentContainer">
                        <!-- 标签页内容将通过JS动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 右侧功能区 -->
            <div class="sidebar">
                <!-- 用户面板 -->
                <div class="card user-panel">
                    <div class="user-avatar" id="userAvatar">
                        <img src="" alt="用户头像" id="userAvatarImg">
                    </div>
                    <div class="user-name" id="userName">游客</div>
                    <p style="color: var(--gray); margin-bottom: 20px;">登录以保存您的分析历史记录</p>

                    <div class="user-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="analysisCount">0</div>
                            <div class="stat-label">分析次数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="historyCount">0</div>
                            <div class="stat-label">历史记录</div>
                        </div>
                    </div>

                    <button class="nav-btn" id="logoutBtn" style="display: none; margin-top: 20px;">
                        <i class="fas fa-sign-out-alt"></i> 退出登录
                    </button>
                </div>

                <!-- 历史记录面板 -->
                <div class="card history-panel">
                    <div class="card-header">
                        <i class="fas fa-history card-icon"></i>
                        <h2>历史记录</h2>
                    </div>

                    <div class="history-list" id="historyList">
                        <div class="history-item">
                            <div class="history-title">
                                <span>情感分析</span>
                                <span class="history-date">2023-10-15</span>
                            </div>
                            <div class="history-text">啊啊啊啊啊啊你是一个又好用又专业的信息提取系统啊啊啊啊啊啊</div>
                            <div class="history-actions">
                                <button class="history-action-btn" title="重新分析">
                                    <i class="fas fa-redo"></i>
                                </button>
                                <button class="history-action-btn" title="删除记录">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="history-item">
                            <div class="history-title">
                                <span>实体识别</span>
                                <span class="history-date">2023-10-14</span>
                            </div>
                            <div class="history-text">哇哦哦！！第一口就喝到了珠珠唉！！！</div>
                            <div class="history-actions">
                                <button class="history-action-btn" title="重新分析">
                                    <i class="fas fa-redo"></i>
                                </button>
                                <button class="history-action-btn" title="删除记录">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="history-item">
                            <div class="history-title">
                                <span>词性标注</span>
                                <span class="history-date">2023-10-12</span>
                            </div>
                            <div class="history-text">没能让系统大人使出全力，真是抱歉</div>
                            <div class="history-actions">
                                <button class="history-action-btn" title="重新分析">
                                    <i class="fas fa-redo"></i>
                                </button>
                                <button class="history-action-btn" title="删除记录">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 客服面板 -->
                <div class="card support-panel">
                    <div class="card-header">
                        <i class="fas fa-headset card-icon"></i>
                        <h2>抬棺人士（划掉）  专业客服</h2>
                    </div>

                    <p>24h待命，专业团队为你服务</p>

                    <div class="support-options">
                        <div class="support-option">
                            <div class="support-icon">
                                <img src="" alt="客服头像" id="supportAvatar1">
                            </div>
                            <div class="support-text">
                                <h4>在线聊天</h4>
                                <p>来和客服蕉流♂焦流♂</p>
                            </div>
                        </div>

                        <div class="support-option">
                            <div class="support-icon">
                                <img src="" alt="客服头像" id="supportAvatar2">
                            </div>
                            <div class="support-text">
                                <h4>发送邮件</h4>
                                <p>genshin@impart.com</p>
                            </div>
                        </div>

                        <div class="support-option">
                            <div class="support-icon">
                                <img src="" alt="客服头像" id="supportAvatar3">
                            </div>
                            <div class="support-text">
                                <h4>电话支持</h4>
                                <p>114514-1919810 (9:00-18:00)</p>
                            </div>
                        </div>

                        <div class="support-option">
                            <div class="support-icon">
                                <img src="" alt="客服头像" id="supportAvatar4">
                            </div>
                            <div class="support-text">
                                <h4>常见问题</h4>
                                <p>你所热爱的，就是你的生活</p>
                                <p>陈*，你*******？</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let lastUploadedFilePath = null;

        // 初始化图片URL（在实际应用中这些URL应该来自服务器）
        const avatarUrls = [
            "https://randomuser.me/api/portraits/men/32.jpg",
            "https://randomuser.me/api/portraits/women/44.jpg",
            "https://randomuser.me/api/portraits/men/22.jpg",
            "https://randomuser.me/api/portraits/women/68.jpg"
        ];

        const supportAvatarUrls = [
            "/static/images/8.jpg",
            "/static/images/10.jpg",
            "/static/images/12.jpg",
            "/static/images/13.jpg"
        ];


        // DOM元素
        const textMethod = document.getElementById('textMethod');
        const fileMethod = document.getElementById('fileMethod');
        const textInputSection = document.getElementById('textInputSection');
        const fileInputSection = document.getElementById('fileInputSection');
        const inputText = document.getElementById('inputText');
        const fileInput = document.getElementById('file');
        const fileNameDisplay = document.getElementById('fileName');
        const charCount = document.querySelector('.char-count');
        const featureCards = document.querySelectorAll('.feature-card');
        const processBtn = document.getElementById('processBtn');
        const loader = document.getElementById('loader');
        const resultSection = document.getElementById('resultSection');
        const resultTabs = document.getElementById('resultTabs');
        const tabContentContainer = document.getElementById('tabContentContainer');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const historyBtn = document.getElementById('historyBtn');
        const supportBtn = document.getElementById('supportBtn');
        const adminBtn = document.getElementById('adminBtn');
        const userSection = document.getElementById('userSection');
        const userName = document.getElementById('userName');
        const userAvatarImg = document.getElementById('userAvatarImg');
        const analysisCount = document.getElementById('analysisCount');
        const historyCount = document.getElementById('historyCount');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const profileModal = document.getElementById('profileModal');
        const feedbackModal = document.getElementById('feedbackModal');
        const adminPanelModal = document.getElementById('adminPanelModal');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const closeModals = document.querySelectorAll('.close-modal');
        const exportExcel = document.getElementById('exportExcel');
        const exportPDF = document.getElementById('exportPDF');
        const historyList = document.getElementById('historyList');
        const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const avatarUpload = document.getElementById('avatarUpload');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profilePhone = document.getElementById('profilePhone');
        const profileAge = document.getElementById('profileAge');
        const adminFeedbackList = document.getElementById('adminFeedbackList');

        // 初始化客服头像
        document.getElementById('supportAvatar1').src = supportAvatarUrls[0];
        document.getElementById('supportAvatar2').src = supportAvatarUrls[1];
        document.getElementById('supportAvatar3').src = supportAvatarUrls[2];
        document.getElementById('supportAvatar4').src = supportAvatarUrls[3];

        // 当前选择的状态
        let currentMethod = 'text';
        let selectedFeatures = {
            entities: true,
            pos_tags: true,
            dep_parse: false,
            sentiment: true
        };
        let currentResults = null;
        let currentUser = null;
        let userTags = [];
        let profileTags = [];
        let feedbackList = [];

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 添加字符计数
            updateCharCount();

            // 初始化图表
            initCharts();

            // 更新按钮状态
            updateProcessButtonState();

            // 设置默认头像
            setDefaultAvatar();

            // 初始化标签输入
            initTagInput();
        });
        function loadUserFeedbacks() {
    if (!currentUser) return;
    fetch(`http://localhost:5000/user_feedbacks?email=${encodeURIComponent(currentUser.email)}`)
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('userFeedbackList');
            container.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'feedback-item';
                div.innerHTML = `
                    <div class="feedback-header">
                        <span class="feedback-date">${new Date(item.time).toLocaleString()}</span>
                        <span class="feedback-user">类型：${item.type}</span>
                    </div>
                    <div class="feedback-content">${item.content}</div>
                    <div class="feedback-content" style="margin-top:10px; background:#e9ecef">
                        <strong>管理员回复：</strong><br>
                        ${item.reply || '<i>暂未回复</i>'}
                    </div>
                `;
                container.appendChild(div);
            });
        });
}

document.getElementById('myFeedbackBtn').addEventListener('click', () => {
    loadUserFeedbacks();
    document.getElementById('userFeedbackModal').style.display = 'flex';
});

        // 设置默认头像
        function setDefaultAvatar() {
            const defaultAvatar = avatarUrls[Math.floor(Math.random() * avatarUrls.length)];
            userAvatarImg.src = defaultAvatar;
            profileAvatar.src = defaultAvatar;
        }

        // 初始化标签输入
        function initTagInput() {
            const newTagInput = document.getElementById('newTag');
            const profileNewTagInput = document.getElementById('profileNewTag');
            const tagInputContainer = document.getElementById('tagInput');
            const profileTagInputContainer = document.getElementById('profileTagInput');

            newTagInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && newTagInput.value.trim() !== '') {
                    addTag(newTagInput.value.trim(), tagInputContainer);
                    newTagInput.value = '';
                }
            });

            profileNewTagInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && profileNewTagInput.value.trim() !== '') {
                    addTag(profileNewTagInput.value.trim(), profileTagInputContainer);
                    profileNewTagInput.value = '';
                }
            });
        }

        // 添加标签
        function addTag(tag, container) {
            const tagElement = document.createElement('div');
            tagElement.className = 'tag';
            tagElement.innerHTML = `
                ${tag}
                <span class="tag-remove">&times;</span>
            `;

            container.insertBefore(tagElement, container.querySelector('input'));

            // 添加删除事件
            tagElement.querySelector('.tag-remove').addEventListener('click', () => {
                tagElement.remove();
            });
        }

        // 更新字符计数
        function updateCharCount() {
            const count = inputText.value.length;
            charCount.textContent = `${count} 字符`;
        }

        // 输入方式选择
        textMethod.addEventListener('click', () => {
            currentMethod = 'text';
            textMethod.classList.add('active');
            fileMethod.classList.remove('active');
            fileInputSection.classList.remove('active');
        });

        fileMethod.addEventListener('click', () => {
            currentMethod = 'file';
            fileMethod.classList.add('active');
            textMethod.classList.remove('active');
            fileInputSection.classList.add('active');
        });

        // 文本输入监听
        inputText.addEventListener('input', updateCharCount);

        // 文件选择监听
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                fileNameDisplay.textContent = `已选择: ${file.name} (${formatFileSize(file.size)})`;
            } else {
                fileNameDisplay.textContent = '未选择文件';
            }
            updateProcessButtonState();
        });

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 功能选择
        featureCards.forEach(card => {
            card.addEventListener('click', () => {
                const feature = card.dataset.feature;
                selectedFeatures[feature] = !selectedFeatures[feature];
                card.classList.toggle('active', selectedFeatures[feature]);

                // 更新按钮状态
                updateProcessButtonState();
            });
        });

        // 更新处理按钮状态
        function updateProcessButtonState() {
            const anyFeatureSelected = Object.values(selectedFeatures).some(val => val);
            const hasInput = currentMethod === 'text'
                ? inputText.value.trim().length > 0
                : fileInput.files.length > 0;

            processBtn.disabled = !(anyFeatureSelected && hasInput);
        }

        // 输入变化时更新按钮状态
        inputText.addEventListener('input', updateProcessButtonState);
        fileInput.addEventListener('change', updateProcessButtonState);

        // 处理按钮点击事件
        processBtn.addEventListener('click', async function() {
            // 显示加载动画
            loader.style.display = 'block';
            resultSection.style.display = 'none';

            let text = "";
            const options = Object.keys(selectedFeatures).filter(key => selectedFeatures[key]);

            try {
                if (currentMethod === 'file') {
                    //
                    if (fileInput.files[0]) {
                        const formData = new FormData();
                        formData.append('file', fileInput.files[0]);

                        const uploadRes = await fetch('http://localhost:5000/upload', {
                            method: 'POST',
                            body: formData
                        });
                        const uploadResult = await uploadRes.json();
                        lastUploadedFilePath = uploadResult.file_path;
                    }

                    //
                    if (!lastUploadedFilePath) {
                        showError("请上传一个文件！");
                        return;
                    }

                    //
                    const response = await fetch('http://localhost:5000/process', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            file_path: lastUploadedFilePath,
                            options: options
                        })
                    });

                    const result = await response.json();

                    currentResults = result;
                    displayResults(result, options);
                    addToHistory("文件分析结果", "来自上传文件内容", options, result);
                }
                 else {
                    text = inputText.value.trim();
                    if (!text) {
                        showError("请输入文本内容！");
                        return;
                    }

                    // API处理
                    loader.style.display = 'block';
                    const response = await fetch('http://localhost:5000/process', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            text: text,
                            options: options
                        })
                    });
                    const result = await response.json();


                    currentResults = result;
                    displayResults(result, options);

                    // 添加到历史记录
                    addToHistory("文本分析结果", text.substring(0, 100) + "...", options, result);


                    // 更新分析次数
                    if (currentUser) {
                        document.getElementById('analysisCount').textContent =
                            parseInt(document.getElementById('analysisCount').textContent) + 1;
                    }
                }
            } catch (error) {
                showError("处理错误: " + error.message);
            } finally {
                loader.style.display = 'none';
            }
        });

        // 显示错误
        function showError(message) {
            loader.style.display = 'none';
            alert(message);
        }

        // 显示结果
        function displayResults(results, selectedOptions) {
            // 清空之前的结果
            resultTabs.innerHTML = '';
            tabContentContainer.innerHTML = '';

            // 显示结果区域
            resultSection.style.display = 'block';

            // 为每个选中的功能创建标签页
            selectedOptions.forEach((option, index) => {
                // 创建标签按钮
                const tabBtn = document.createElement('button');
                tabBtn.className = 'tab-btn' + (index === 0 ? ' active' : '');
                tabBtn.textContent = getOptionName(option);
                tabBtn.dataset.tab = option;

                tabBtn.addEventListener('click', () => {
                    // 移除所有active类
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                    // 添加active类
                    tabBtn.classList.add('active');
                    document.getElementById(`tab-${option}`).classList.add('active');
                });

                resultTabs.appendChild(tabBtn);

                // 创建标签内容
                const tabContent = document.createElement('div');
                tabContent.className = 'tab-content' + (index === 0 ? ' active' : '');
                tabContent.id = `tab-${option}`;

                // 根据功能类型填充内容
                switch(option) {
                    case 'entities':
                        tabContent.innerHTML = renderEntities(results.entities || []);
                        break;
                    case 'pos_tags':
                        tabContent.innerHTML = renderPosTags(results.pos_tags || []);
                        break;
                    case 'dep_parse':
                        tabContent.innerHTML = renderDepParse(results.dep_parse || []);
                        break;
                    case 'sentiment':
                        tabContent.innerHTML = renderSentiment(results.sentiment || {});
                        break;
                    default:
                        tabContent.innerHTML = `<p>无可用数据</p>`;
                }

                tabContentContainer.appendChild(tabContent);
            });

            // 初始化图表
            initCharts();

            // 滚动到结果区域
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // 初始化图表
        function initCharts() {
            // 实体类型图表
            const entitiesCtx = document.getElementById('entitiesChart');
            if (entitiesCtx) {
                new Chart(entitiesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['人名', '组织', '地点', '日期', '其他'],
                        datasets: [{
                            data: [12, 19, 8, 5, 3],
                            backgroundColor: [
                                '#06d6a0',
                                '#4361ee',
                                '#ef476f',
                                '#7209b7',
                                '#ffd166'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }

            // 词性分布图表
            const posCtx = document.getElementById('posChart');
            if (posCtx) {
                new Chart(posCtx, {
                    type: 'bar',
                    data: {
                        labels: ['名词', '动词', '形容词', '副词', '介词'],
                        datasets: [{
                            label: '词性分布',
                            data: [65, 59, 40, 32, 28],
                            backgroundColor: '#4361ee'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // 获取选项名称
        function getOptionName(option) {
            const names = {
                'entities': '命名实体',
                'pos_tags': '词性标注',
                'dep_parse': '句法分析',
                'sentiment': '情感分析'
            };
            return names[option] || option;
        }

        // 渲染命名实体结果
        function renderEntities(entities) {
            if (entities.length === 0) return `<p>未识别到命名实体</p>`;

            let html = `<div class="result-card">
                <h4><i class="fas fa-tags"></i> 识别的实体</h4>
                <div class="entities-container">`;

            entities.forEach(entity => {
                html += `<span class="entity-tag entity-${entity.type}">${entity.entity} <small>(${entity.type})</small></span>`;
            });

            html += `</div></div>`;

            // 按类型分组统计
            const typeCount = {};
            entities.forEach(entity => {
                typeCount[entity.type] = (typeCount[entity.type] || 0) + 1;
            });

            html += `<div class="result-card">
                <h4><i class="fas fa-chart-pie"></i> 实体统计</h4>
                <div class="chart-container">
                    <canvas id="entitiesChart"></canvas>
                </div>
            </div>`;

            return html;
        }

        // 渲染词性标注结果
        function renderPosTags(tags) {
            if (tags.length === 0) return `<p>未进行词性标注</p>`;

            let html = `<div class="result-card">
                <h4><i class="fas fa-comment-dots"></i> 词性标注结果</h4>
                <div class="tags-container">`;

            tags.forEach(tag => {
                html += `<span class="entity-tag">${tag.word} <small>(${tag.pos})</small></span>`;
            });

            html += `</div></div>`;

            // 词性统计
            html += `<div class="result-card">
                <h4><i class="fas fa-chart-bar"></i> 词性分布</h4>
                <div class="chart-container">
                    <canvas id="posChart"></canvas>
                </div>
            </div>`;

            return html;
        }

        // 渲染情感分析结果
        function renderSentiment(sentiment) {
            if (!sentiment.polarity) return `<p>未进行情感分析</p>`;

            // 确定情感分类
            let sentimentClass = 'neutral';
            let sentimentLabel = '中性';

            if (sentiment.polarity > 0.2) {
                sentimentClass = 'positive';
                sentimentLabel = '积极';
            } else if (sentiment.polarity < -0.2) {
                sentimentClass = 'negative';
                sentimentLabel = '消极';
            }

            return `<div class="result-card">
                <h4><i class="fas fa-smile"></i> 情感分析结果</h4>

                <div class="sentiment-indicator">
                    <div>情感极性:</div>
                    <div class="sentiment-bar">
                        <div class="sentiment-fill" style="width: ${Math.abs(sentiment.polarity)*100}%;
                            background: ${sentimentClass === 'positive' ? '#06d6a0' :
                                       sentimentClass === 'negative' ? '#ef476f' : '#ffd166'};"></div>
                    </div>
                    <div><strong>${sentimentLabel}</strong> (${sentiment.polarity.toFixed(2)})</div>
                </div>

                <div class="sentiment-indicator">
                    <div>主观程度:</div>
                    <div class="sentiment-bar">
                        <div class="sentiment-fill" style="width: ${sentiment.subjectivity*100}%;
                            background: #4361ee;"></div>
                    </div>
                    <div><strong>${sentiment.subjectivity > 0.5 ? '主观' : '客观'}</strong> (${sentiment.subjectivity.toFixed(2)})</div>
                </div>

                <div style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-top: 0;">解读:</h4>
                    <p>文本整体情感为 <strong>${sentimentLabel}</strong>，情感强度为 ${Math.abs(sentiment.polarity).toFixed(2)}。</p>
                    <p>文本主观性评分为 ${sentiment.subjectivity.toFixed(2)}，表明内容${sentiment.subjectivity > 0.5 ? '主观性较强' : '较为客观'}。</p>
                </div>
            </div>`;
        }

        // 用户登录功能
        loginBtn.addEventListener('click', () => {
            loginModal.style.display = 'flex';
        });

        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            loginModal.style.display = 'none';
            registerModal.style.display = 'flex';
        });

        showLogin.addEventListener('click', (e) => {
            e.preventDefault();
            registerModal.style.display = 'none';
            loginModal.style.display = 'flex';
        });

        closeModals.forEach(btn => {
            btn.addEventListener('click', () => {
                loginModal.style.display = 'none';
                registerModal.style.display = 'none';
                profileModal.style.display = 'none';
                feedbackModal.style.display = 'none';
                adminPanelModal.style.display = 'none';
            });
        });

        // 调用后端
        document.querySelector('#loginModal .submit-btn').addEventListener('click', async () => {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    const formData = new FormData();
    formData.append('email', email);
    formData.append('password', password);

    const response = await fetch('http://localhost:5000/login', {
        method: 'POST',
        body: formData
    });

    const result = await response.json();

    if (result.success) {
    currentUser = {
        name: result.name,
        email: email,
        avatar: result.avatar
    };

    updateUserUI(currentUser);

    //
    if (currentUser.email === 'admin@example.com') {
        currentUser.isAdmin = true;
        document.getElementById('adminBtn').style.display = 'inline-block';
    }

    loginModal.style.display = 'none';
}
 else {
        alert("登录失败：" + result.error);
    }
});


        // 模拟注册
        document.querySelector('#registerModal .submit-btn').addEventListener('click', async () => {
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirm = document.getElementById('registerConfirm').value;
    const avatarFile = document.getElementById('registerAvatar')?.files[0];

    if (!name || !email || !password || password !== confirm) {
        alert("请完整填写信息，并确保两次密码一致");
        return;
    }

    const formData = new FormData();
    formData.append('name', name);
    formData.append('email', email);
    formData.append('password', password);
    if (avatarFile) {
        formData.append('avatar', avatarFile);
    }

    try {
        const res = await fetch('http://localhost:5000/register', {
            method: 'POST',
            body: formData
        });
        const result = await res.json();

        if (result.success) {
            alert('注册成功，请登录');
            registerModal.style.display = 'none';
            loginModal.style.display = 'flex';
        } else {
            alert('注册失败：' + result.error);
        }
    } catch (err) {
        alert('请求出错：' + err.message);
    }
});



        // 更新用户界面
        function updateUserUI(user) {
            userName.textContent = user.name;
            userAvatarImg.src = user.avatar;
            profileAvatar.src = user.avatar;
            document.getElementById('analysisCount').textContent = '0';
            document.getElementById('historyCount').textContent = '0';

            // 更新导航栏
            userSection.innerHTML = `
                <div class="user-info" id="userProfileBtn">
                    <div class="avatar"><img src="${user.avatar}" alt="用户头像"></div>
                    <span>${user.name}</span>
                </div>
            `;

            logoutBtn.style.display = 'block';

            // 绑定个人中心点击事件
            document.getElementById('userProfileBtn').addEventListener('click', () => {
                openProfileModal(user);
            });

            // 用户头像点击事件
            document.querySelector('.user-avatar').addEventListener('click', () => {
                openProfileModal(user);
            });

            // 用户名点击事件
            userName.addEventListener('click', () => {
                openProfileModal(user);
            });
        }

        // 打开个人中心模态框
        function openProfileModal(user) {
            profileName.value = user.name;
            profileEmail.value = user.email;
            profilePhone.value = user.phone;
            profileAge.value = user.age || '';
            profileAvatar.src = user.avatar;

            // 设置性别选择
            document.querySelectorAll('.gender-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.gender === user.gender) {
                    option.classList.add('active');
                }
            });

            // 设置标签
            const profileTagInput = document.getElementById('profileTagInput');
            profileTagInput.innerHTML = '<input type="text" id="profileNewTag" placeholder="输入标签后按回车">';
            user.tags.forEach(tag => {
                addTag(tag, profileTagInput);
            });

            profileModal.style.display = 'flex';
        }

        // 保存个人资料
        saveProfileBtn.addEventListener('click', () => {
            if (currentUser) {
                // 更新用户信息
                currentUser.name = profileName.value;
                currentUser.phone = profilePhone.value;
                currentUser.age = profileAge.value;

                // 更新性别
                const selectedGender = document.querySelector('.gender-option.active');
                if (selectedGender) {
                    currentUser.gender = selectedGender.dataset.gender;
                }

                // 更新标签
                currentUser.tags = [];
                document.querySelectorAll('#profileTagInput .tag').forEach(tag => {
                    currentUser.tags.push(tag.textContent.replace('×', '').trim());
                });

                // 更新用户界面
                updateUserUI(currentUser);

                // 关闭模态框
                profileModal.style.display = 'none';

                alert('个人信息已更新！');
            }
        });

        // 头像上传
        document.querySelector('.user-avatar').addEventListener('click', function() {
            avatarUpload.click();
        });

        avatarUpload.addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();

                reader.onload = function(event) {
                    userAvatarImg.src = event.target.result;
                    profileAvatar.src = event.target.result;

                    if (currentUser) {
                        currentUser.avatar = event.target.result;
                        document.querySelector('.user-info .avatar img').src = event.target.result;
                    }
                }

                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // 性别选择
        document.querySelectorAll('.gender-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.gender-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                this.classList.add('active');
            });
        });

        // 退出登录
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            userName.textContent = '游客';
            setDefaultAvatar();
            document.getElementById('analysisCount').textContent = '0';
            document.getElementById('historyCount').textContent = '0';
            adminBtn.style.display = 'none';

            userSection.innerHTML = `
                <button class="nav-btn primary" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>登录/注册</span>
                </button>
            `;
            logoutBtn.style.display = 'none';

            // 重新绑定登录按钮事件
            document.getElementById('loginBtn').addEventListener('click', () => {
                loginModal.style.display = 'flex';
            });
        });

        // 添加到历史记录
        function addToHistory(title, text, options, result) {
    if (!currentUser) return;

    const now = new Date();
    const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;

    const historyItem = document.createElement('div');
    historyItem.className = 'history-item';
    historyItem.innerHTML = `
        <div class="history-title">
            <span>${title}</span>
            <span class="history-date">${dateStr}</span>
        </div>
        <div class="history-text">${text}</div>
        <div class="history-actions">
            <button class="history-action-btn" title="还原分析">
                <i class="fas fa-redo"></i>
            </button>
            <button class="history-action-btn" title="删除记录">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;

    //
    historyItem.dataset.options = JSON.stringify(options);
    historyItem.dataset.result = JSON.stringify(result);

    historyList.insertBefore(historyItem, historyList.firstChild);

    // 更新历史记录计数
    document.getElementById('historyCount').textContent =
        parseInt(document.getElementById('historyCount').textContent) + 1;

    // 点击“还原分析”
    historyItem.querySelector('.history-action-btn:nth-child(1)').addEventListener('click', () => {
        const options = JSON.parse(historyItem.dataset.options);
        const result = JSON.parse(historyItem.dataset.result);

        displayResults(result, options);  //
        resultSection.scrollIntoView({ behavior: 'smooth' });
    });

    // 删除
    historyItem.querySelector('.history-action-btn:nth-child(2)').addEventListener('click', () => {
        historyItem.remove();
        document.getElementById('historyCount').textContent =
            parseInt(document.getElementById('historyCount').textContent) - 1;
    });
}


        // 导出Excel
        exportExcel.addEventListener('click', () => {
            if (!currentResults) {
                alert('没有可导出的结果数据');
                return;
            }

            // 创建模拟数据
            const data = [
                ['分析类型', '结果'],
                ['命名实体', currentResults.entities.map(e => `${e.entity} (${e.type})`).join(', ')],
                ['情感极性', currentResults.sentiment.polarity],
                ['主观程度', currentResults.sentiment.subjectivity]
            ];

            // 创建工作簿
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);

            // 添加工作表到工作簿
            XLSX.utils.book_append_sheet(wb, ws, '分析结果');

            // 导出Excel文件
            XLSX.writeFile(wb, '文本分析结果.xlsx');
        });

        // 导出PDF
        exportPDF.addEventListener('click', () => {
            if (!currentResults) {
                alert('没有可导出的结果数据');
                return;
            }

            // 使用html2canvas将结果区域转换为图片
            html2canvas(resultSection).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                const imgWidth = 210; // A4宽度210mm
                const pageHeight = 297; // A4高度297mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // 添加分页
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('文本分析报告.pdf');
            });
        });

        // 提交反馈
        submitFeedbackBtn.addEventListener('click', async () => {
    const content = document.getElementById('feedbackContent').value;
    const type = document.getElementById('feedbackType').value;

    if (!currentUser || !currentUser.email) {
        alert('请先登录再提交反馈');
        return;
    }
    if (!content.trim()) {
        alert('反馈内容不能为空');
        return;
    }

    const formData = new FormData();
    formData.append('email', currentUser.email);
    formData.append('type', type);
    formData.append('content', content);

    const res = await fetch('http://localhost:5000/submit_feedback', {
        method: 'POST',
        body: formData
    });
    const result = await res.json();
    if (result.success) {
        alert('反馈提交成功！');
        feedbackModal.style.display = 'none';
        document.getElementById('feedbackContent').value = '';
    } else {
        alert('提交失败：' + result.error);
    }
});


        // 管理员面板
        adminBtn.addEventListener('click', () => {
    adminPanelModal.style.display = 'flex';
    loadAdminFeedbacks();
});
        function loadAdminFeedbacks() {
    fetch('http://localhost:5000/admin_feedbacks')
        .then(res => res.json())
        .then(data => {
            adminFeedbackList.innerHTML = '';
            data.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'feedback-item';
                div.innerHTML = `
                    <div class="feedback-header">
                        <span class="feedback-user">${item.email}（${item.type}）</span>
                        <span class="feedback-date">${new Date(item.time).toLocaleString()}</span>
                    </div>
                    <div class="feedback-content">${item.content}</div>
                    <div class="form-group" style="margin-top:10px;">
                        <label>管理员回复：</label>
                        <textarea rows="2" class="form-control reply-text" data-index="${index}">${item.reply || ''}</textarea>
                        <button class="submit-btn save-reply" data-index="${index}" style="margin-top:5px;">保存回复</button>
                    </div>
                `;
                adminFeedbackList.appendChild(div);
            });

            // 添加事件绑定
            document.querySelectorAll('.save-reply').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const index = btn.dataset.index;
                    const replyText = btn.previousElementSibling.value;
                    const formData = new FormData();
                    formData.append('index', index);
                    formData.append('reply', replyText);
                    const res = await fetch('http://localhost:5000/reply_feedback', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await res.json();
                    if (result.success) {
                        alert('回复已保存');
                    } else {
                        alert('保存失败：' + result.error);
                    }
                });
            });
        });
}

        // 获取反馈类型文本
        function getFeedbackType(type) {
            const types = {
                'bug': '系统错误',
                'suggestion': '功能建议',
                'other': '其他问题'
            };
            return types[type] || type;
        }

        // 处理反馈操作
        adminFeedbackList.addEventListener('click', (e) => {
            if (e.target.closest('[data-action]')) {
                const button = e.target.closest('[data-action]');
                const action = button.dataset.action;
                const id = parseInt(button.dataset.id);

                if (action === 'resolve') {
                    // 标记为已解决
                    const feedback = feedbackList.find(f => f.id === id);
                    if (feedback) {
                        feedback.status = '已解决';
                        button.innerHTML = '<i class="fas fa-check"></i> 已解决';
                        button.disabled = true;
                    }
                } else if (action === 'delete') {
                    // 删除反馈
                    feedbackList = feedbackList.filter(f => f.id !== id);
                    button.closest('.feedback-item').remove();
                }
            }
        });

        // 在线客服
        supportBtn.addEventListener('click', () => {
            feedbackModal.style.display = 'flex';
        });

        // 历史记录按钮
        historyBtn.addEventListener('click', () => {
            document.querySelector('.history-panel').scrollIntoView({ behavior: 'smooth' });
        });

        // 初始化模态框关闭事件
        window.addEventListener('click', (e) => {
            if (e.target === loginModal) loginModal.style.display = 'none';
            if (e.target === registerModal) registerModal.style.display = 'none';
            if (e.target === profileModal) profileModal.style.display = 'none';
            if (e.target === feedbackModal) feedbackModal.style.display = 'none';
            if (e.target === adminPanelModal) adminPanelModal.style.display = 'none';
        });
    </script>
</body>
</html>